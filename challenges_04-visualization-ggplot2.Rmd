---
title: "Data visualization with ggplot2: Challenges"
author: "Thea Van Rossum"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    toc_float: yes
    number_sections: yes
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(rprojroot)

projRoot <- rprojroot::find_rstudio_root_file()
setwd(projRoot)

library(tidyverse)
library(skimr) # nice data summaries
library(lemon) # print tables nicely in knit result without explicit call to kable()
knit_print.data.frame <- lemon_print

knitr::opts_chunk$set(
  root.dir = projRoot,
  echo=TRUE,
  warning=FALSE,
  message=FALSE)

```


# Challenge - scatter plot
>
> Use what you just learned to create a scatter plot of `weight` over
> `species_id` with the field plot types showing in different colors. Is this a good
> way to show this type of data?
> ```{r scatter-challenge, answer=TRUE, purl=FALSE}
> ggplot(data = surveys_complete, mapping = aes(x = species_id, y = weight)) +
>    geom_point(aes(color = plot_type))
> ```

# Challenge - hex plot (bonus)

>
> Scatter plots can be useful exploratory tools for small datasets. For data
> sets with large numbers of observations, such as the `surveys_complete` data
> set, overplotting of points can be a limitation of scatter plots. One strategy
> for handling such settings is to use hexagonal binning of observations. The
> plot space is tessellated into hexagons. Each hexagon is assigned a color
> based on the number of observations that fall within its boundaries.  To use
> hexagonal binning with **`ggplot2`**, first install the R package `hexbin`
> from CRAN:
>
>
> ```{r, eval = FALSE}
> install.packages("hexbin")
> library(hexbin)
> ```
>
> Then use the `geom_hex()` function:
>
> ```{r, eval = FALSE}
> surveys_plot +
>  geom_hex()
> ```
>
> - What are the relative strengths and weaknesses of a hexagonal bin plot
>   compared to a scatter plot? Examine the above scatter plot and compare it
>   with the hexagonal bin plot that you created.

```{r hexbin-challenge, echo=FALSE, eval=FALSE, purl=TRUE}
### Challenge with hexbin
##
## To use the hexagonal binning with **`ggplot2`**, first install the `hexbin`
## package from CRAN:

install.packages("hexbin")
library(hexbin)

## Then use the `geom_hex()` function:

ggplot(data = surveys_complete, mapping = aes(x = weight, y = hindfoot_length)) +
    geom_hex()

## What are the relative strengths and weaknesses of a hexagonal bin
## plot compared to a scatter plot?
```

# Challenge: violoin plot
>
> Boxplots are useful summaries, but hide the *shape* of the distribution. For
> example, if the distribution is bimodal, we would not see it in a
> boxplot. An alternative to the boxplot is the violin plot, where the shape 
(of the density of points) is drawn.
>
> - Replace the box plot with a violin plot; see `geom_violin()`.
>
> In many types of data, it is important to consider the *scale* of the
> observations.  For example, it may be worth changing the scale of the axis to
> better distribute the observations in the space of the plot.  Changing the scale
> of the axes is done similarly to adding/modifying other components (i.e., by
> incrementally adding commands). Try making these modifications:
>
> - Represent weight on the log~10~ scale; see `scale_y_log10()`.
>
> So far, we've looked at the distribution of weight within species. Try making a
> new plot to explore the distribution of another variable within each species.
>
> - Create a boxplot for `hindfoot_length`. Overlay the boxplot layer on a jitter
>   layer to show actual measurements.
>

> SKIP IF HAVEN'T COVERED FACTORS
> - Add color to the data points on your boxplot according to the plot from which
>   the sample was taken (`plot_id`).
>
> *Hint:* Check the class for `plot_id`. Consider changing the class of `plot_id` from integer to factor. Why does this change how R makes the graph?

```{r boxplot-challenge, eval=FALSE, purl=TRUE, echo=FALSE}
## Challenge with boxplots:
##  Start with the boxplot we created:
ggplot(data = surveys_complete, mapping = aes(x = species_id, y = weight)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.3)

##  1. Replace the box plot with a violin plot; see `geom_violin()`.

ggplot(data = surveys_complete, mapping = aes(x = species_id, y = weight)) +
  geom_jitter(alpha = 0.3)+
  geom_violin()

##  2. Represent weight on the log10 scale; see `scale_y_log10()`.

ggplot(data = surveys_complete, mapping = aes(x = species_id, y = weight)) +
  geom_jitter(alpha = 0.3)+
  geom_violin() + 
  scale_y_log10()

##  3. Create boxplot for `hindfoot_length` overlaid on a jitter layer.

ggplot(data = surveys_complete, mapping = aes(x = species_id, y = hindfoot_length)) +
  geom_jitter(alpha = 0.3)+
  geom_boxplot() + 
  scale_y_log10()
# 
# ##  4. Add color to the data points on your boxplot according to the
# ##  plot from which the sample was taken (`plot_id`).
# ##  *Hint:* Check the class for `plot_id`. Consider changing the class
# ##  of `plot_id` from integer to factor. Why does this change how R
# ##  makes the graph?
# 
# ggplot(data = surveys_complete, mapping = aes(x = species_id, y = hindfoot_length)) +
#   geom_jitter(alpha = 0.3,aes(color=plot_id))+
#   geom_boxplot() + 
#   scale_y_log10()
# 
# surveys_complete %>% mutate(plot_id = factor(plot_id)) %>% 
# ggplot(mapping = aes(x = species_id, y = hindfoot_length)) +
#   geom_jitter(alpha = 0.3,aes(color=plot_id))+
#   geom_boxplot() + 
#   scale_y_log10()

```


# Challenge: box plot alternatives (bonus)

check out https://www.r-graph-gallery.com/all-graphs/
Is there another libary that you could download and use to make some nice plots?


#Challenge: line plot
Does the number of observations per species change over the year e.g. are there some months where more animals have been oberved? For simplicity, consider the total number of animals observed per month across all the years (not the average per year)

```{r time-series-with-colors, purl=FALSE}
monthly_counts <- surveys_complete %>%
  group_by(month, species_id) %>% 
  summarise(n = n())
ggplot(data = monthly_counts, mapping = aes(x = month, y = n, color = species_id)) +
    geom_line()
```

#Challenge: line plot with split-apply-combine - bonus

Bonus: Calculate the mean number of observations per month across all the years for each species. Does this change if you look at the median? Hint: this will require two group-and-summarise steps

```{r time-series-with-colors-mean-by-month, purl=FALSE}

mean_monthly_counts <- surveys_complete %>%
  group_by(month, year, species_id) %>% 
  summarise(nObsPerMonthPerYear = n()) %>% 
  ungroup() %>% 
  group_by(month,species_id) %>% 
  summarise(meanObsPerMonth = mean(nObsPerMonthPerYear)) 

ggplot(data = mean_monthly_counts, 
       mapping = aes(x = month, y = meanObsPerMonth, 
                     color = species_id, group=species_id)) +
  geom_line()
```

#Challenge: seasonality without facets (bonus bonus)
Does the number of animals observed per month vary from year to year? What if you look at these numbers across all species? What about within individual species?

```{r}

surveys_complete %>%
  group_by(year, month) %>% 
  summarise(observationsPerMonthPerYear = n()) %>% 
  mutate(month = factor(month,ordered = T,levels = 1:12)) %>% 
  ggplot(aes(x=month,y=observationsPerMonthPerYear))+
  geom_violin()+
  geom_boxplot()
  

surveys_complete %>%
  mutate(month = factor(month,ordered = T,levels = 1:12)) %>% 
  group_by(year, month, species_id) %>% 
  summarise(observationsPerMonthPerYear = n()) %>% 
  ggplot(aes(x=month,y=observationsPerMonthPerYear))+
  geom_boxplot()+
  facet_wrap(.~species_id,scales="free_y")

surveys_complete %>%
  mutate(month = factor(month,ordered = T,levels = 1:12)) %>% 
  group_by(year, month, species_id) %>% 
  summarise(observationsPerMonthPerYear = n()) %>% 
  ggplot(aes(x=month,y=observationsPerMonthPerYear,group=year))+
  geom_line()+
  facet_wrap(.~species_id,scales="free_y")

```

# Challenge: weight by year 

Use what you just learned to create a plot that depicts how the average weight
of each species changes through the years.

```{r average-weight-time-series, answer=TRUE, purl=FALSE}
 yearly_weight <- surveys_complete %>%
                 group_by(year, species_id) %>%
                  summarize(avg_weight = mean(weight))
 ggplot(data = yearly_weight, mapping = aes(x=year, y=avg_weight)) +
    geom_line() +
    facet_wrap(.~ species_id) +
    theme_bw()
```

```{r sessionInfo}
sessionInfo()
```